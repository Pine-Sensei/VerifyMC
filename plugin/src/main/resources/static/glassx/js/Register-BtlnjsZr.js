import{d as e,u as a,j as r,w as s,s as l,v as t,a as o,b as i,t as n,q as d,o as u,c,K as m,n as p,C as v,L as g,f as h,M as x}from"./vendor-Cz9CUY-1.js";import{a as w}from"./api-wA-pqWBP.js";import{u as b}from"./index-KtTz8vnu.js";import{_ as f}from"./components-CLK7JpZA.js";import"./utils-BHPIt2x-.js";const y={class:"discord-link"},_={key:0,class:"linked-state"},k={class:"discord-badge"},$={class:"discord-username"},q={class:"linked-text"},A={key:1,class:"unlinked-state"},C=["disabled"],j={key:0,class:"discord-icon",viewBox:"0 0 24 24",fill:"currentColor"},B={key:1,class:"spinner"},I={key:0,class:"required-text"},z=f(e({__name:"DiscordLink",props:{username:{},required:{type:Boolean}},emits:["linked","unlinked"],setup(e,{emit:c}){const m=e,p=c,{t:v}=a(),{success:g,error:h}=b(),x=r(!1),f=r(!1),z=r(null);let U=null;const F=async()=>{if(m.username&&!x.value){x.value=!0;try{const e=await w.getDiscordAuthUrl(m.username);if(e.success&&e.auth_url){const a=window.open(e.auth_url,"discord_auth","width=500,height=800");L();const r=setInterval(()=>{a&&a.closed&&(clearInterval(r),setTimeout(()=>D(),1e3))},500)}else h(e.msg||v("discord.link_failed"))}catch(e){h(v("discord.link_failed"))}finally{x.value=!1}}},D=async()=>{if(m.username)try{const e=await w.getDiscordStatus(m.username);e.success&&e.linked&&(f.value=!0,z.value=e.user,V(),p("linked",e.user),g(v("discord.link_success")))}catch(e){}},L=()=>{V();let e=0;U=window.setInterval(()=>{e++,e>=150?V():D()},2e3)},V=()=>{U&&(clearInterval(U),U=null)};return s(()=>m.username,async e=>{e?await D():(f.value=!1,z.value=null)}),l(()=>{m.username&&D()}),t(()=>{V()}),(e,a)=>{var r,s;return u(),o("div",y,[f.value?(u(),o("div",_,[i("div",k,[a[0]||(a[0]=i("svg",{class:"discord-icon",viewBox:"0 0 24 24",fill:"#5865F2"},[i("path",{d:"M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028 14.09 14.09 0 0 0 1.226-1.994.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10.2 10.2 0 0 0 .372-.292.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03z"})],-1)),i("span",$,n((null==(r=z.value)?void 0:r.global_name)||(null==(s=z.value)?void 0:s.username)||"Discord"),1),a[1]||(a[1]=i("span",{class:"linked-check"},"âœ“",-1))]),i("p",q,n(e.$t("discord.linked")),1)])):(u(),o("div",A,[i("button",{type:"button",onClick:F,disabled:x.value||!e.username,class:"discord-btn"},[x.value?(u(),o("div",B)):(u(),o("svg",j,a[2]||(a[2]=[i("path",{d:"M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028 14.09 14.09 0 0 0 1.226-1.994.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10.2 10.2 0 0 0 .372-.292.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03z"},null,-1)]))),i("span",null,n(e.$t("discord.link_button")),1)],8,C),e.required?(u(),o("p",I,n(e.$t("discord.required_hint")),1)):d("",!0)]))])}}}),[["__scopeId","data-v-812961c6"]]),U={class:"text-2xl font-bold text-white mb-3 relative z-10"},F={class:"text-gray-300 mb-4 relative z-10"},D={class:"space-y-3"},L={for:"username",class:"block text-sm font-medium text-white mb-1"},V=["placeholder"],M={key:0,class:"mt-1 text-sm text-red-400"},R={for:"email",class:"block text-sm font-medium text-white mb-1"},S=["placeholder"],E={key:0,class:"mt-1 text-sm text-red-400"},T={key:0},Z={for:"password",class:"block text-sm font-medium text-white mb-1"},K=["placeholder"],O={key:0,class:"mt-1 text-sm text-red-400"},G={key:1,class:"mt-1 text-xs text-gray-300"},H={key:1},J={for:"code",class:"block text-sm font-medium text-white mb-1"},N={class:"flex flex-col sm:flex-row gap-2"},P=["placeholder"],Q=["disabled"],W={key:0,class:"mt-1 text-sm text-red-400"},X={key:2},Y={for:"captcha",class:"block text-sm font-medium text-white mb-1"},ee={class:"flex flex-col sm:flex-row gap-2 items-center"},ae=["placeholder"],re=["title"],se=["src"],le={key:1,class:"h-10 w-24 flex items-center justify-center text-white/60 text-sm"},te={key:0,class:"mt-1 text-sm text-red-400"},oe={class:"mt-1 text-xs text-gray-300"},ie={key:3,class:"pt-2"},ne={class:"block text-sm font-medium text-white mb-2"},de={key:0,class:"mt-1 text-sm text-red-400"},ue=["disabled"],ce={key:0,class:"spinner"},me=e({__name:"RegistrationForm",setup(e){const{t:s,locale:t}=a(),{success:f,error:y}=b(),_=r(!1),k=r(!1),$=r("");r("success");const q=r({login:{enable_email:!1,email_smtp:""},admin:{},frontend:{theme:"",logo_url:"",announcement:"",web_server_prefix:"",username_regex:""},authme:{enabled:!1,require_password:!1,auto_register:!1,auto_unregister:!1,password_regex:""},captcha:{enabled:!1,email_enabled:!0,type:"math"}}),A=r(""),C=r(""),j=c(()=>{var e;return(null==(e=q.value.captcha)?void 0:e.enabled)||!1}),B=c(()=>{var e;return!1!==(null==(e=q.value.captcha)?void 0:e.email_enabled)}),I=r(!1),me=c(()=>{var e;return(null==(e=q.value.discord)?void 0:e.enabled)||!1}),pe=c(()=>{var e;return(null==(e=q.value.discord)?void 0:e.required)||!1}),ve=c(()=>q.value.authme),ge=c(()=>{var e,a;return(null==(e=ve.value)?void 0:e.enabled)&&(null==(a=ve.value)?void 0:a.require_password)});l(async()=>{var e;try{const a=await w.getConfig();q.value=a,(null==(e=q.value.captcha)?void 0:e.enabled)&&await he()}catch(a){}});const he=async()=>{try{const e=await w.getCaptcha();e.success&&e.token&&e.image&&(C.value=e.token,A.value=e.image)}catch(e){}},xe=m({username:"",email:"",code:"",password:"",captchaAnswer:""}),we=m({username:"",email:"",code:"",password:"",captcha:"",discord:""}),be=e=>{I.value=!0,we.discord=""},fe=()=>{I.value=!1},ye=()=>{var e,a;we.username="",xe.username?(null==(e=q.value.frontend)?void 0:e.username_regex)&&!new RegExp(q.value.frontend.username_regex).test(xe.username)?we.username=s("register.validation.username_format",{regex:q.value.frontend.username_regex}):(null==(a=q.value.frontend)?void 0:a.username_regex)||/^[a-zA-Z0-9_]+$/.test(xe.username)||(we.username=s("register.validation.username_format",{regex:"^[a-zA-Z0-9_]+$"})):we.username=s("register.validation.username_required")},_e=()=>{we.email="",xe.email?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(xe.email)||(we.email=s("register.validation.email_format")):we.email=s("register.validation.email_required")},ke=()=>{var e;we.password="",ge.value&&(xe.password?(null==(e=ve.value)?void 0:e.password_regex)&&!new RegExp(ve.value.password_regex).test(xe.password)&&(we.password=s("register.validation.password_format",{regex:ve.value.password_regex})):we.password=s("register.validation.password_required"))},$e=()=>{we.code="",B.value&&!xe.code&&(we.code=s("register.validation.code_required"))},qe=()=>{we.captcha="",j.value&&!xe.captchaAnswer&&(we.captcha=s("register.validation.captcha_required"))},Ae=()=>{ye(),_e(),ke(),$e(),qe(),we.discord="",pe.value&&!I.value&&(we.discord=s("discord.required"))},Ce=c(()=>{let e=xe.username&&xe.email&&!we.username&&!we.email;return B.value&&(e=e&&xe.code&&!we.code),j.value&&(e=e&&xe.captchaAnswer&&!we.captcha),ge.value&&(e=e&&xe.password&&!we.password),pe.value&&(e=e&&I.value&&!we.discord),e}),je=r(0),Be=r(null),Ie=e=>{je.value=e,Be.value&&clearInterval(Be.value),Be.value=setInterval(()=>{je.value--,je.value<=0&&(clearInterval(Be.value),Be.value=null)},1e3)},ze=async()=>{if(!(k.value||je.value>0||(_e(),we.email))){k.value=!0,$.value="";try{const e=xe.email.trim().toLowerCase(),a=await w.sendCode({email:e,language:t.value});if(a.success)f(s("register.codeSent")),Ie(60);else if(a.remaining_seconds&&a.remaining_seconds>0){Ie(a.remaining_seconds);const e=s("common.seconds","seconds"),r=s("common.second","second"),l=s("common.second"),t=!a.msg||a.msg.includes(l)||a.msg.includes(e)||a.msg.includes(r)?s("register.sendFailed"):a.msg;t&&y(t)}else{const e=a.msg&&a.msg!==s("register.sendFailed")?a.msg:s("register.sendFailed");y(e)}}catch(e){y(s("register.sendFailed"))}finally{k.value=!1}}},Ue=async()=>{if(!_.value&&(Ae(),Ce.value)){_.value=!0,$.value="";try{const e={username:xe.username,email:xe.email.trim().toLowerCase(),uuid:"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const a=16*Math.random()|0,r="x"==e?a:3&a|8;return r.toString(16)}),language:t.value};B.value&&(e.code=xe.code),j.value&&(e.captchaToken=C.value,e.captchaAnswer=xe.captchaAnswer),ge.value&&(e.password=xe.password);const a=await w.register(e);a.success?(f(s("register.success")),Object.assign(xe,{username:"",email:"",code:"",password:"",captchaAnswer:""})):(y(a.msg||s("register.failed")),j.value&&await he())}catch(e){y(s("register.failed")),j.value&&await he()}finally{_.value=!1}}};return(e,a)=>(u(),o("div",{class:p(["bg-white/10 backdrop-blur-xl border border-white/20 rounded-lg p-6 shadow-2xl relative overflow-hidden",ge.value?"w-full max-w-md":"w-full max-w-sm"])},[a[5]||(a[5]=i("div",{class:"absolute inset-0 bg-gradient-to-br from-white/5 to-transparent pointer-events-none"},null,-1)),i("h2",U,n(e.$t("register.title")),1),i("p",F,n(e.$t("register.subtitle")),1),i("form",{onSubmit:x(Ue,["prevent"]),class:"space-y-4 relative z-10"},[i("div",D,[i("div",null,[i("label",L,n(e.$t("register.form.username")),1),v(i("input",{id:"username","onUpdate:modelValue":a[0]||(a[0]=e=>xe.username=e),type:"text",placeholder:e.$t("register.form.username_placeholder"),class:p(["w-full px-4 py-2.5 bg-white/15 backdrop-blur-xl border border-white/25 rounded-lg text-white placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent transition-all duration-300 shadow-inner",{"border-red-400 focus:ring-red-400":we.username}]),onBlur:ye},null,42,V),[[g,xe.username]]),we.username?(u(),o("p",M,n(we.username),1)):d("",!0)]),i("div",null,[i("label",R,n(e.$t("register.form.email")),1),v(i("input",{id:"email","onUpdate:modelValue":a[1]||(a[1]=e=>xe.email=e),type:"email",placeholder:e.$t("register.form.email_placeholder"),class:p(["w-full px-4 py-2.5 bg-white/15 backdrop-blur-xl border border-white/25 rounded-lg text-white placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent transition-all duration-300 shadow-inner",{"border-red-400 focus:ring-red-400":we.email}]),onBlur:_e},null,42,S),[[g,xe.email]]),we.email?(u(),o("p",E,n(we.email),1)):d("",!0)]),ge.value?(u(),o("div",T,[i("label",Z,n(e.$t("register.form.password")),1),v(i("input",{id:"password","onUpdate:modelValue":a[2]||(a[2]=e=>xe.password=e),type:"password",placeholder:e.$t("register.form.password_placeholder"),class:p(["w-full px-4 py-2.5 bg-white/15 backdrop-blur-xl border border-white/25 rounded-lg text-white placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent transition-all duration-300 shadow-inner",{"border-red-400 focus:ring-red-400":we.password}]),onBlur:ke},null,42,K),[[g,xe.password]]),we.password?(u(),o("p",O,n(we.password),1)):d("",!0),ve.value.password_regex?(u(),o("p",G,n(e.$t("register.form.password_hint",{regex:ve.value.password_regex})),1)):d("",!0)])):d("",!0),B.value?(u(),o("div",H,[i("label",J,n(e.$t("register.form.code")),1),i("div",N,[v(i("input",{id:"code","onUpdate:modelValue":a[3]||(a[3]=e=>xe.code=e),type:"text",placeholder:e.$t("register.form.code_placeholder"),class:p(["w-full px-4 py-2.5 bg-white/15 backdrop-blur-xl border border-white/25 rounded-lg text-white placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent transition-all duration-300 shadow-inner",{"border-red-400 focus:ring-red-400":we.code}]),onBlur:$e},null,42,P),[[g,xe.code]]),i("button",{type:"button",onClick:ze,disabled:k.value||!xe.email||je.value>0,class:"px-4 py-2.5 bg-white/15 backdrop-blur-xl border border-white/25 text-white rounded-lg hover:bg-white/25 hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed whitespace-nowrap transition-all duration-300 shadow-inner"},n(k.value?e.$t("register.sending"):je.value>0?`${je.value}s`:e.$t("register.sendCode")),9,Q)]),we.code?(u(),o("p",W,n(we.code),1)):d("",!0)])):d("",!0),j.value?(u(),o("div",X,[i("label",Y,n(e.$t("register.form.captcha")),1),i("div",ee,[v(i("input",{id:"captcha","onUpdate:modelValue":a[4]||(a[4]=e=>xe.captchaAnswer=e),type:"text",placeholder:e.$t("register.form.captcha_placeholder"),class:p(["w-full px-4 py-2.5 bg-white/15 backdrop-blur-xl border border-white/25 rounded-lg text-white placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent transition-all duration-300 shadow-inner",{"border-red-400 focus:ring-red-400":we.captcha}]),onBlur:qe},null,42,ae),[[g,xe.captchaAnswer]]),i("div",{class:"captcha-image-container cursor-pointer border border-white/20 rounded-md overflow-hidden bg-white/10 backdrop-blur-sm hover:bg-white/20 transition-colors flex-shrink-0",onClick:he,title:e.$t("register.form.captcha_refresh")},[A.value?(u(),o("img",{key:0,src:A.value,alt:"captcha",class:"h-10 w-auto"},null,8,se)):(u(),o("div",le,n(e.$t("common.loading")),1))],8,re)]),we.captcha?(u(),o("p",te,n(we.captcha),1)):d("",!0),i("p",oe,n(e.$t("register.form.captcha_hint")),1)])):d("",!0),me.value?(u(),o("div",ie,[i("label",ne," Discord "+n(pe.value?"*":""),1),h(z,{username:xe.username,required:pe.value,onLinked:be,onUnlinked:fe},null,8,["username","required"]),we.discord?(u(),o("p",de,n(we.discord),1)):d("",!0)])):d("",!0)]),i("button",{type:"submit",disabled:_.value||!Ce.value,class:"w-full bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5"},[_.value?(u(),o("div",ce)):d("",!0),i("span",null,n(e.$t("register.form.submit")),1)],8,ue)],32)],2))}}),pe={class:"flex min-h-screen w-full items-center justify-center p-4 md:p-6 lg:p-10 bg-[#030303]"},ve=e({__name:"Register",setup:e=>(e,a)=>(u(),o("div",pe,[h(me)]))});export{ve as default};
