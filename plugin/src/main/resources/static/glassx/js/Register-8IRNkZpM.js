import{d as e,u as a,j as r,c as t,s,K as l,a as o,n,b as i,t as d,q as u,C as c,L as m,M as p,o as g,f as x}from"./vendor-Cz9CUY-1.js";import{a as v}from"./api-52LtxC81.js";import{u as h}from"./index-DiLVYeX1.js";import"./utils-BHPIt2x-.js";import"./components-CLK7JpZA.js";const w={class:"text-2xl font-bold text-white mb-3 relative z-10"},b={class:"text-gray-300 mb-4 relative z-10"},f={class:"space-y-3"},y={for:"username",class:"block text-sm font-medium text-white mb-1"},_=["placeholder"],k={key:0,class:"mt-1 text-sm text-red-400"},$={for:"email",class:"block text-sm font-medium text-white mb-1"},j=["placeholder"],A={key:0,class:"mt-1 text-sm text-red-400"},C={key:0},q={for:"password",class:"block text-sm font-medium text-white mb-1"},z=["placeholder"],B={key:0,class:"mt-1 text-sm text-red-400"},F={key:1,class:"mt-1 text-xs text-gray-300"},U={key:1},V={for:"code",class:"block text-sm font-medium text-white mb-1"},R={class:"flex flex-col sm:flex-row gap-2"},I=["placeholder"],L=["disabled"],S={key:0,class:"mt-1 text-sm text-red-400"},E={key:2},M={for:"captcha",class:"block text-sm font-medium text-white mb-1"},Z={class:"flex flex-col sm:flex-row gap-2 items-center"},K=["placeholder"],O=["title"],T=["src"],D={key:1,class:"h-10 w-24 flex items-center justify-center text-white/60 text-sm"},G={key:0,class:"mt-1 text-sm text-red-400"},H={class:"mt-1 text-xs text-gray-300"},J=["disabled"],N={key:0,class:"spinner"},P=e({__name:"RegistrationForm",setup(e){const{t:x,locale:P}=a(),{success:Q,error:W}=h(),X=r(!1),Y=r(!1),ee=r("");r("success");const ae=r({login:{enable_email:!1,email_smtp:""},admin:{},frontend:{theme:"",logo_url:"",announcement:"",web_server_prefix:"",username_regex:""},authme:{enabled:!1,require_password:!1,auto_register:!1,auto_unregister:!1,password_regex:""},captcha:{enabled:!1,email_enabled:!0,type:"math"}}),re=r(""),te=r(""),se=t(()=>{var e;return(null==(e=ae.value.captcha)?void 0:e.enabled)||!1}),le=t(()=>{var e;return!1!==(null==(e=ae.value.captcha)?void 0:e.email_enabled)}),oe=t(()=>ae.value.authme),ne=t(()=>{var e,a;return(null==(e=oe.value)?void 0:e.enabled)&&(null==(a=oe.value)?void 0:a.require_password)});s(async()=>{var e;try{const a=await v.getConfig();ae.value=a,(null==(e=ae.value.captcha)?void 0:e.enabled)&&await ie()}catch(a){}});const ie=async()=>{try{const e=await v.getCaptcha();e.success&&e.token&&e.image&&(te.value=e.token,re.value=e.image)}catch(e){}},de=l({username:"",email:"",code:"",password:"",captchaAnswer:""}),ue=l({username:"",email:"",code:"",password:"",captcha:""}),ce=()=>{var e,a;ue.username="",de.username?(null==(e=ae.value.frontend)?void 0:e.username_regex)&&!new RegExp(ae.value.frontend.username_regex).test(de.username)?ue.username=x("register.validation.username_format",{regex:ae.value.frontend.username_regex}):(null==(a=ae.value.frontend)?void 0:a.username_regex)||/^[a-zA-Z0-9_]+$/.test(de.username)||(ue.username=x("register.validation.username_format",{regex:"^[a-zA-Z0-9_]+$"})):ue.username=x("register.validation.username_required")},me=()=>{ue.email="",de.email?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(de.email)||(ue.email=x("register.validation.email_format")):ue.email=x("register.validation.email_required")},pe=()=>{var e;ue.password="",ne.value&&(de.password?(null==(e=oe.value)?void 0:e.password_regex)&&!new RegExp(oe.value.password_regex).test(de.password)&&(ue.password=x("register.validation.password_format",{regex:oe.value.password_regex})):ue.password=x("register.validation.password_required"))},ge=()=>{ue.code="",le.value&&!de.code&&(ue.code=x("register.validation.code_required"))},xe=()=>{ue.captcha="",se.value&&!de.captchaAnswer&&(ue.captcha=x("register.validation.captcha_required"))},ve=t(()=>{let e=de.username&&de.email&&!ue.username&&!ue.email;return le.value&&(e=e&&de.code&&!ue.code),se.value&&(e=e&&de.captchaAnswer&&!ue.captcha),ne.value&&(e=e&&de.password&&!ue.password),e}),he=r(0),we=r(null),be=e=>{he.value=e,we.value&&clearInterval(we.value),we.value=setInterval(()=>{he.value--,he.value<=0&&(clearInterval(we.value),we.value=null)},1e3)},fe=async()=>{if(!(Y.value||he.value>0||(me(),ue.email))){Y.value=!0,ee.value="";try{const e=de.email.trim().toLowerCase(),a=await v.sendCode({email:e,language:P.value});if(a.success)Q(x("register.codeSent")),be(60);else if(a.remaining_seconds&&a.remaining_seconds>0){be(a.remaining_seconds);const e=x("common.seconds","seconds"),r=x("common.second","second"),t=x("common.second"),s=!a.msg||a.msg.includes(t)||a.msg.includes(e)||a.msg.includes(r)?x("register.sendFailed"):a.msg;s&&W(s)}else{const e=a.msg&&a.msg!==x("register.sendFailed")?a.msg:x("register.sendFailed");W(e)}}catch(e){W(x("register.sendFailed"))}finally{Y.value=!1}}},ye=async()=>{if(!X.value&&(ce(),me(),pe(),ge(),xe(),ve.value)){X.value=!0,ee.value="";try{const e={username:de.username,email:de.email.trim().toLowerCase(),uuid:"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const a=16*Math.random()|0,r="x"==e?a:3&a|8;return r.toString(16)}),language:P.value};le.value&&(e.code=de.code),se.value&&(e.captchaToken=te.value,e.captchaAnswer=de.captchaAnswer),ne.value&&(e.password=de.password);const a=await v.register(e);a.success?(Q(x("register.success")),Object.assign(de,{username:"",email:"",code:"",password:"",captchaAnswer:""})):(W(a.msg||x("register.failed")),se.value&&await ie())}catch(e){W(x("register.failed")),se.value&&await ie()}finally{X.value=!1}}};return(e,a)=>(g(),o("div",{class:n(["bg-white/10 backdrop-blur-xl border border-white/20 rounded-lg p-6 shadow-2xl relative overflow-hidden",ne.value?"w-full max-w-md":"w-full max-w-sm"])},[a[5]||(a[5]=i("div",{class:"absolute inset-0 bg-gradient-to-br from-white/5 to-transparent pointer-events-none"},null,-1)),i("h2",w,d(e.$t("register.title")),1),i("p",b,d(e.$t("register.subtitle")),1),i("form",{onSubmit:p(ye,["prevent"]),class:"space-y-4 relative z-10"},[i("div",f,[i("div",null,[i("label",y,d(e.$t("register.form.username")),1),c(i("input",{id:"username","onUpdate:modelValue":a[0]||(a[0]=e=>de.username=e),type:"text",placeholder:e.$t("register.form.username_placeholder"),class:n(["w-full px-4 py-2.5 bg-white/15 backdrop-blur-xl border border-white/25 rounded-lg text-white placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent transition-all duration-300 shadow-inner",{"border-red-400 focus:ring-red-400":ue.username}]),onBlur:ce},null,42,_),[[m,de.username]]),ue.username?(g(),o("p",k,d(ue.username),1)):u("",!0)]),i("div",null,[i("label",$,d(e.$t("register.form.email")),1),c(i("input",{id:"email","onUpdate:modelValue":a[1]||(a[1]=e=>de.email=e),type:"email",placeholder:e.$t("register.form.email_placeholder"),class:n(["w-full px-4 py-2.5 bg-white/15 backdrop-blur-xl border border-white/25 rounded-lg text-white placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent transition-all duration-300 shadow-inner",{"border-red-400 focus:ring-red-400":ue.email}]),onBlur:me},null,42,j),[[m,de.email]]),ue.email?(g(),o("p",A,d(ue.email),1)):u("",!0)]),ne.value?(g(),o("div",C,[i("label",q,d(e.$t("register.form.password")),1),c(i("input",{id:"password","onUpdate:modelValue":a[2]||(a[2]=e=>de.password=e),type:"password",placeholder:e.$t("register.form.password_placeholder"),class:n(["w-full px-4 py-2.5 bg-white/15 backdrop-blur-xl border border-white/25 rounded-lg text-white placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent transition-all duration-300 shadow-inner",{"border-red-400 focus:ring-red-400":ue.password}]),onBlur:pe},null,42,z),[[m,de.password]]),ue.password?(g(),o("p",B,d(ue.password),1)):u("",!0),oe.value.password_regex?(g(),o("p",F,d(e.$t("register.form.password_hint",{regex:oe.value.password_regex})),1)):u("",!0)])):u("",!0),le.value?(g(),o("div",U,[i("label",V,d(e.$t("register.form.code")),1),i("div",R,[c(i("input",{id:"code","onUpdate:modelValue":a[3]||(a[3]=e=>de.code=e),type:"text",placeholder:e.$t("register.form.code_placeholder"),class:n(["w-full px-4 py-2.5 bg-white/15 backdrop-blur-xl border border-white/25 rounded-lg text-white placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent transition-all duration-300 shadow-inner",{"border-red-400 focus:ring-red-400":ue.code}]),onBlur:ge},null,42,I),[[m,de.code]]),i("button",{type:"button",onClick:fe,disabled:Y.value||!de.email||he.value>0,class:"px-4 py-2.5 bg-white/15 backdrop-blur-xl border border-white/25 text-white rounded-lg hover:bg-white/25 hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed whitespace-nowrap transition-all duration-300 shadow-inner"},d(Y.value?e.$t("register.sending"):he.value>0?`${he.value}s`:e.$t("register.sendCode")),9,L)]),ue.code?(g(),o("p",S,d(ue.code),1)):u("",!0)])):u("",!0),se.value?(g(),o("div",E,[i("label",M,d(e.$t("register.form.captcha")),1),i("div",Z,[c(i("input",{id:"captcha","onUpdate:modelValue":a[4]||(a[4]=e=>de.captchaAnswer=e),type:"text",placeholder:e.$t("register.form.captcha_placeholder"),class:n(["w-full px-4 py-2.5 bg-white/15 backdrop-blur-xl border border-white/25 rounded-lg text-white placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent transition-all duration-300 shadow-inner",{"border-red-400 focus:ring-red-400":ue.captcha}]),onBlur:xe},null,42,K),[[m,de.captchaAnswer]]),i("div",{class:"captcha-image-container cursor-pointer border border-white/20 rounded-md overflow-hidden bg-white/10 backdrop-blur-sm hover:bg-white/20 transition-colors flex-shrink-0",onClick:ie,title:e.$t("register.form.captcha_refresh")},[re.value?(g(),o("img",{key:0,src:re.value,alt:"captcha",class:"h-10 w-auto"},null,8,T)):(g(),o("div",D,d(e.$t("common.loading")),1))],8,O)]),ue.captcha?(g(),o("p",G,d(ue.captcha),1)):u("",!0),i("p",H,d(e.$t("register.form.captcha_hint")),1)])):u("",!0)]),i("button",{type:"submit",disabled:X.value||!ve.value,class:"w-full bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5"},[X.value?(g(),o("div",N)):u("",!0),i("span",null,d(e.$t("register.form.submit")),1)],8,J)],32)],2))}}),Q={class:"flex min-h-screen w-full items-center justify-center p-4 md:p-6 lg:p-10 bg-[#030303]"},W=e({__name:"Register",setup:e=>(e,a)=>(g(),o("div",Q,[x(P)]))});export{W as default};
