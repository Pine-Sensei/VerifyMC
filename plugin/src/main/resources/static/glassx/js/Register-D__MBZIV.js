import{d as e,u as a,j as s,w as t,s as r,v as l,a as i,e as n,t as o,q as d,o as c,c as u,K as m,n as v,L as p,C as g,M as x,f as h}from"./vendor-DZJtS0Dx.js";import{a as w}from"./api-wA-pqWBP.js";import{u as f}from"./index-C4GvCbsu.js";import{_ as b}from"./components-BV-BoSpK.js";import"./utils-B_VQ4cod.js";const _={class:"discord-link"},k={key:0,class:"linked-state"},y={class:"discord-badge"},$={class:"discord-username"},C={class:"linked-text"},A={key:1,class:"unlinked-state"},q=["disabled"],j={key:0,class:"discord-icon",viewBox:"0 0 127.14 96.36",fill:"currentColor"},B={key:1,class:"spinner"},I={key:0,class:"required-text"},M=b(e({__name:"DiscordLink",props:{username:{},required:{type:Boolean}},emits:["linked","unlinked"],setup(e,{emit:u}){const m=e,v=u,{t:p}=a(),{success:g,error:x}=f(),h=s(!1),b=s(!1),M=s(null);let S=null;const Z=async()=>{if(m.username&&!h.value){h.value=!0;try{const e=await w.getDiscordAuthUrl(m.username);if(e.success&&e.auth_url){const a=window.open(e.auth_url,"discord_auth","width=500,height=800");z();const s=setInterval(()=>{a&&a.closed&&(clearInterval(s),setTimeout(()=>U(),1e3))},500)}else x(e.msg||p("discord.link_failed"))}catch(e){x(p("discord.link_failed"))}finally{h.value=!1}}},U=async()=>{if(m.username)try{const e=await w.getDiscordStatus(m.username);e.success&&e.linked&&(b.value=!0,M.value=e.user,F(),v("linked",e.user),g(p("discord.link_success")))}catch(e){}},z=()=>{F();let e=0;S=window.setInterval(()=>{e++,e>=150?F():U()},2e3)},F=()=>{S&&(clearInterval(S),S=null)};return t(()=>m.username,async e=>{e?await U():(b.value=!1,M.value=null)}),r(()=>{m.username&&U()}),l(()=>{F()}),(e,a)=>{var s,t;return c(),i("div",_,[b.value?(c(),i("div",k,[n("div",y,[a[0]||(a[0]=n("svg",{class:"discord-icon",viewBox:"0 0 127.14 96.36",fill:"#5865F2"},[n("path",{d:"M107.7,8.07A105.15,105.15,0,0,0,81.47,0a72.06,72.06,0,0,0-3.36,6.83A97.68,97.68,0,0,0,49,6.83,72.37,72.37,0,0,0,45.64,0,105.89,105.89,0,0,0,19.39,8.09C2.79,32.65-1.71,56.6.54,80.21h0A105.73,105.73,0,0,0,32.71,96.36,77.7,77.7,0,0,0,39.6,85.25a68.42,68.42,0,0,1-10.85-5.18c.91-.66,1.8-1.34,2.66-2a75.57,75.57,0,0,0,64.32,0c.87.71,1.76,1.39,2.66,2a68.68,68.68,0,0,1-10.87,5.19,77,77,0,0,0,6.89,11.1A105.25,105.25,0,0,0,126.6,80.22h0C129.24,52.84,122.09,29.11,107.7,8.07ZM42.45,65.69C36.18,65.69,31,60,31,53s5-12.74,11.43-12.74S54,46,53.89,53,48.84,65.69,42.45,65.69Zm42.24,0C78.41,65.69,73.25,60,73.25,53s5-12.74,11.44-12.74S96.23,46,96.12,53,91.08,65.69,84.69,65.69Z"})],-1)),n("span",$,o((null==(s=M.value)?void 0:s.global_name)||(null==(t=M.value)?void 0:t.username)||"Discord"),1),a[1]||(a[1]=n("span",{class:"linked-check"},"âœ“",-1))]),n("p",C,o(e.$t("discord.linked")),1)])):(c(),i("div",A,[n("button",{type:"button",onClick:Z,disabled:h.value||!e.username,class:"discord-btn"},[h.value?(c(),i("div",B)):(c(),i("svg",j,a[2]||(a[2]=[n("path",{d:"M107.7,8.07A105.15,105.15,0,0,0,81.47,0a72.06,72.06,0,0,0-3.36,6.83A97.68,97.68,0,0,0,49,6.83,72.37,72.37,0,0,0,45.64,0,105.89,105.89,0,0,0,19.39,8.09C2.79,32.65-1.71,56.6.54,80.21h0A105.73,105.73,0,0,0,32.71,96.36,77.7,77.7,0,0,0,39.6,85.25a68.42,68.42,0,0,1-10.85-5.18c.91-.66,1.8-1.34,2.66-2a75.57,75.57,0,0,0,64.32,0c.87.71,1.76,1.39,2.66,2a68.68,68.68,0,0,1-10.87,5.19,77,77,0,0,0,6.89,11.1A105.25,105.25,0,0,0,126.6,80.22h0C129.24,52.84,122.09,29.11,107.7,8.07ZM42.45,65.69C36.18,65.69,31,60,31,53s5-12.74,11.43-12.74S54,46,53.89,53,48.84,65.69,42.45,65.69Zm42.24,0C78.41,65.69,73.25,60,73.25,53s5-12.74,11.44-12.74S96.23,46,96.12,53,91.08,65.69,84.69,65.69Z"},null,-1)]))),n("span",null,o(e.$t("discord.link_button")),1)],8,q),e.required?(c(),i("p",I,o(e.$t("discord.required_hint")),1)):d("",!0)]))])}}}),[["__scopeId","data-v-fd732edf"]]),S={class:"relative bg-white/[0.08] backdrop-blur-2xl border border-white/[0.15] rounded-2xl p-8 shadow-2xl overflow-hidden"},Z={class:"relative z-10 text-center mb-6"},U={class:"text-2xl font-bold text-white mb-2 tracking-tight"},z={class:"text-white/60 text-sm"},F={class:"space-y-3"},D={for:"username",class:"block text-sm font-medium text-white mb-1"},L=["placeholder"],V={key:0,class:"mt-1 text-sm text-red-400"},R={for:"email",class:"block text-sm font-medium text-white mb-1"},E=["placeholder"],T={key:0,class:"mt-1 text-sm text-red-400"},H={key:0},K={for:"password",class:"block text-sm font-medium text-white mb-1"},O=["placeholder"],G={key:0,class:"mt-1 text-sm text-red-400"},J={key:1,class:"mt-1 text-xs text-gray-300"},N={key:1},P={for:"code",class:"block text-sm font-medium text-white mb-1"},Q={class:"flex flex-col sm:flex-row gap-2"},W=["placeholder"],X=["disabled"],Y={key:0,class:"mt-1 text-sm text-red-400"},ee={key:2},ae={for:"captcha",class:"block text-sm font-medium text-white mb-1"},se={class:"flex flex-col sm:flex-row gap-2 items-center"},te=["placeholder"],re=["title"],le=["src"],ie={key:1,class:"h-11 w-28 flex items-center justify-center text-white/60 text-sm"},ne={key:0,class:"mt-1 text-sm text-red-400"},oe={class:"mt-1 text-xs text-gray-300"},de={key:3,class:"pt-2"},ce={class:"block text-sm font-medium text-white mb-2"},ue={key:0,class:"mt-1 text-sm text-red-400"},me=["disabled"],ve={key:0,class:"spinner"},pe=b(e({__name:"RegistrationForm",setup(e){const{t:t,locale:l}=a(),{success:b,error:_}=f(),k=s(!1),y=s(!1),$=s("");s("success");const C=s({login:{enable_email:!1,email_smtp:""},admin:{},frontend:{theme:"",logo_url:"",announcement:"",web_server_prefix:"",username_regex:""},authme:{enabled:!1,require_password:!1,auto_register:!1,auto_unregister:!1,password_regex:""},captcha:{enabled:!1,email_enabled:!0,type:"math"}}),A=s(""),q=s(""),j=u(()=>{var e;return(null==(e=C.value.captcha)?void 0:e.enabled)||!1}),B=u(()=>{var e;return!1!==(null==(e=C.value.captcha)?void 0:e.email_enabled)}),I=s(!1),pe=u(()=>{var e;return(null==(e=C.value.discord)?void 0:e.enabled)||!1}),ge=u(()=>{var e;return(null==(e=C.value.discord)?void 0:e.required)||!1}),xe=u(()=>C.value.authme),he=u(()=>{var e,a;return(null==(e=xe.value)?void 0:e.enabled)&&(null==(a=xe.value)?void 0:a.require_password)});r(async()=>{var e;try{const a=await w.getConfig();C.value=a,(null==(e=C.value.captcha)?void 0:e.enabled)&&await we()}catch(a){}});const we=async()=>{try{const e=await w.getCaptcha();e.success&&e.token&&e.image&&(q.value=e.token,A.value=e.image)}catch(e){}},fe=m({username:"",email:"",code:"",password:"",captchaAnswer:""}),be=m({username:"",email:"",code:"",password:"",captcha:"",discord:""}),_e=e=>{I.value=!0,be.discord=""},ke=()=>{I.value=!1},ye=()=>{var e,a;be.username="",fe.username?(null==(e=C.value.frontend)?void 0:e.username_regex)&&!new RegExp(C.value.frontend.username_regex).test(fe.username)?be.username=t("register.validation.username_format",{regex:C.value.frontend.username_regex}):(null==(a=C.value.frontend)?void 0:a.username_regex)||/^[a-zA-Z0-9_]+$/.test(fe.username)||(be.username=t("register.validation.username_format",{regex:"^[a-zA-Z0-9_]+$"})):be.username=t("register.validation.username_required")},$e=()=>{be.email="",fe.email?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(fe.email)||(be.email=t("register.validation.email_format")):be.email=t("register.validation.email_required")},Ce=()=>{var e;be.password="",he.value&&(fe.password?(null==(e=xe.value)?void 0:e.password_regex)&&!new RegExp(xe.value.password_regex).test(fe.password)&&(be.password=t("register.validation.password_format",{regex:xe.value.password_regex})):be.password=t("register.validation.password_required"))},Ae=()=>{be.code="",B.value&&!fe.code&&(be.code=t("register.validation.code_required"))},qe=()=>{be.captcha="",j.value&&!fe.captchaAnswer&&(be.captcha=t("register.validation.captcha_required"))},je=()=>{ye(),$e(),Ce(),Ae(),qe(),be.discord="",ge.value&&!I.value&&(be.discord=t("discord.required"))},Be=u(()=>{let e=fe.username&&fe.email&&!be.username&&!be.email;return B.value&&(e=e&&fe.code&&!be.code),j.value&&(e=e&&fe.captchaAnswer&&!be.captcha),he.value&&(e=e&&fe.password&&!be.password),ge.value&&(e=e&&I.value&&!be.discord),e}),Ie=s(0),Me=s(null),Se=e=>{Ie.value=e,Me.value&&clearInterval(Me.value),Me.value=setInterval(()=>{Ie.value--,Ie.value<=0&&(clearInterval(Me.value),Me.value=null)},1e3)},Ze=async()=>{if(!(y.value||Ie.value>0||($e(),be.email))){y.value=!0,$.value="";try{const e=fe.email.trim().toLowerCase(),a=await w.sendCode({email:e,language:l.value});if(a.success)b(t("register.codeSent")),Se(60);else if(a.remaining_seconds&&a.remaining_seconds>0){Se(a.remaining_seconds);const e=t("common.seconds","seconds"),s=t("common.second","second"),r=t("common.second"),l=!a.msg||a.msg.includes(r)||a.msg.includes(e)||a.msg.includes(s)?t("register.sendFailed"):a.msg;l&&_(l)}else{const e=a.msg&&a.msg!==t("register.sendFailed")?a.msg:t("register.sendFailed");_(e)}}catch(e){_(t("register.sendFailed"))}finally{y.value=!1}}},Ue=async()=>{if(!k.value&&(je(),Be.value)){k.value=!0,$.value="";try{const e={username:fe.username,email:fe.email.trim().toLowerCase(),uuid:"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const a=16*Math.random()|0,s="x"==e?a:3&a|8;return s.toString(16)}),language:l.value};B.value&&(e.code=fe.code),j.value&&(e.captchaToken=q.value,e.captchaAnswer=fe.captchaAnswer),he.value&&(e.password=fe.password);const a=await w.register(e);a.success?(b(t("register.success")),Object.assign(fe,{username:"",email:"",code:"",password:"",captchaAnswer:""})):(_(a.msg||t("register.failed")),j.value&&await we())}catch(e){_(t("register.failed")),j.value&&await we()}finally{k.value=!1}}};return(e,a)=>(c(),i("div",{class:v(["registration-card",he.value?"w-full max-w-md":"w-full max-w-sm"])},[a[9]||(a[9]=n("div",{class:"absolute inset-0 rounded-2xl bg-gradient-to-r from-blue-500/20 via-purple-500/20 to-pink-500/20 blur-xl opacity-60 animate-gradient-shift"},null,-1)),n("div",S,[a[7]||(a[7]=n("div",{class:"absolute inset-0 bg-gradient-to-br from-white/10 via-transparent to-transparent pointer-events-none"},null,-1)),a[8]||(a[8]=n("div",{class:"absolute top-0 left-0 right-0 h-px bg-gradient-to-r from-transparent via-white/30 to-transparent"},null,-1)),n("div",Z,[a[5]||(a[5]=n("div",{class:"inline-flex items-center justify-center w-16 h-16 rounded-2xl bg-gradient-to-br from-blue-500/20 to-purple-600/20 border border-white/10 mb-4 shadow-lg"},[n("svg",{class:"w-8 h-8 text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"})])],-1)),n("h2",U,o(e.$t("register.title")),1),n("p",z,o(e.$t("register.subtitle")),1)]),n("form",{onSubmit:p(Ue,["prevent"]),class:"space-y-5 relative z-10"},[n("div",F,[n("div",null,[n("label",D,o(e.$t("register.form.username")),1),g(n("input",{id:"username","onUpdate:modelValue":a[0]||(a[0]=e=>fe.username=e),type:"text",placeholder:e.$t("register.form.username_placeholder"),class:v(["glass-input",{"glass-input-error":be.username}]),onBlur:ye},null,42,L),[[x,fe.username]]),be.username?(c(),i("p",V,o(be.username),1)):d("",!0)]),n("div",null,[n("label",R,o(e.$t("register.form.email")),1),g(n("input",{id:"email","onUpdate:modelValue":a[1]||(a[1]=e=>fe.email=e),type:"email",placeholder:e.$t("register.form.email_placeholder"),class:v(["glass-input",{"glass-input-error":be.email}]),onBlur:$e},null,42,E),[[x,fe.email]]),be.email?(c(),i("p",T,o(be.email),1)):d("",!0)]),he.value?(c(),i("div",H,[n("label",K,o(e.$t("register.form.password")),1),g(n("input",{id:"password","onUpdate:modelValue":a[2]||(a[2]=e=>fe.password=e),type:"password",placeholder:e.$t("register.form.password_placeholder"),class:v(["glass-input",{"glass-input-error":be.password}]),onBlur:Ce},null,42,O),[[x,fe.password]]),be.password?(c(),i("p",G,o(be.password),1)):d("",!0),xe.value.password_regex?(c(),i("p",J,o(e.$t("register.form.password_hint",{regex:xe.value.password_regex})),1)):d("",!0)])):d("",!0),B.value?(c(),i("div",N,[n("label",P,o(e.$t("register.form.code")),1),n("div",Q,[g(n("input",{id:"code","onUpdate:modelValue":a[3]||(a[3]=e=>fe.code=e),type:"text",placeholder:e.$t("register.form.code_placeholder"),class:v(["glass-input",{"glass-input-error":be.code}]),onBlur:Ae},null,42,W),[[x,fe.code]]),n("button",{type:"button",onClick:Ze,disabled:y.value||!fe.email||Ie.value>0,class:"glass-button-secondary"},o(y.value?e.$t("register.sending"):Ie.value>0?`${Ie.value}s`:e.$t("register.sendCode")),9,X)]),be.code?(c(),i("p",Y,o(be.code),1)):d("",!0)])):d("",!0),j.value?(c(),i("div",ee,[n("label",ae,o(e.$t("register.form.captcha")),1),n("div",se,[g(n("input",{id:"captcha","onUpdate:modelValue":a[4]||(a[4]=e=>fe.captchaAnswer=e),type:"text",placeholder:e.$t("register.form.captcha_placeholder"),class:v(["glass-input",{"glass-input-error":be.captcha}]),onBlur:qe},null,42,te),[[x,fe.captchaAnswer]]),n("div",{class:"captcha-image-container cursor-pointer border border-white/20 rounded-lg overflow-hidden bg-white/10 backdrop-blur-sm hover:bg-white/20 hover:border-white/30 transition-all duration-300 flex-shrink-0 shadow-lg",onClick:we,title:e.$t("register.form.captcha_refresh")},[A.value?(c(),i("img",{key:0,src:A.value,alt:"captcha",class:"h-11 w-auto"},null,8,le)):(c(),i("div",ie,o(e.$t("common.loading")),1))],8,re)]),be.captcha?(c(),i("p",ne,o(be.captcha),1)):d("",!0),n("p",oe,o(e.$t("register.form.captcha_hint")),1)])):d("",!0),pe.value?(c(),i("div",de,[n("label",ce," Discord "+o(ge.value?"*":""),1),h(M,{username:fe.username,required:ge.value,onLinked:_e,onUnlinked:ke},null,8,["username","required"]),be.discord?(c(),i("p",ue,o(be.discord),1)):d("",!0)])):d("",!0)]),n("button",{type:"submit",disabled:k.value||!Be.value,class:"submit-button"},[k.value?(c(),i("div",ve)):d("",!0),n("span",null,o(e.$t("register.form.submit")),1),a[6]||(a[6]=n("div",{class:"button-shine"},null,-1))],8,me)],32)])],2))}}),[["__scopeId","data-v-d2df0b78"]]),ge={class:"flex min-h-screen w-full items-center justify-center p-4 md:p-6 lg:p-10 bg-[#030303]"},xe=e({__name:"Register",setup:e=>(e,a)=>(c(),i("div",ge,[h(pe)]))});export{xe as default};
