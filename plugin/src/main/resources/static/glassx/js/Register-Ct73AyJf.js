import{d as e,u as r,j as a,c as s,s as l,K as t,a as o,n,b as i,t as d,q as u,C as m,L as c,M as p,o as g,f as x}from"./vendor-Cz9CUY-1.js";import{a as w}from"./api-52LtxC81.js";import{u as b}from"./index-h_a8TuHq.js";import"./utils-BHPIt2x-.js";import"./components-CLK7JpZA.js";const v={class:"text-2xl font-bold text-white mb-3 relative z-10"},f={class:"text-gray-300 mb-4 relative z-10"},h={class:"space-y-3"},y={for:"username",class:"block text-sm font-medium text-white mb-1"},_=["placeholder"],k={key:0,class:"mt-1 text-sm text-red-400"},$={for:"email",class:"block text-sm font-medium text-white mb-1"},j=["placeholder"],q={key:0,class:"mt-1 text-sm text-red-400"},C={key:0},z={for:"password",class:"block text-sm font-medium text-white mb-1"},F=["placeholder"],B={key:0,class:"mt-1 text-sm text-red-400"},R={key:1,class:"mt-1 text-xs text-gray-300"},U={for:"code",class:"block text-sm font-medium text-white mb-1"},V={class:"flex flex-col sm:flex-row gap-2"},I=["placeholder"],L=["disabled"],S={key:0,class:"mt-1 text-sm text-red-400"},A=["disabled"],E={key:0,class:"spinner"},M=e({__name:"RegistrationForm",setup(e){const{t:x}=r(),{success:M,error:Z}=b(),K=a(!1),O=a(!1),D=a("");a("success");const G=a({login:{enable_email:!1,email_smtp:""},admin:{},frontend:{theme:"",logo_url:"",announcement:"",web_server_prefix:"",username_regex:""},authme:{enabled:!1,require_password:!1,auto_register:!1,auto_unregister:!1,password_regex:""}}),H=s(()=>G.value.authme),J=s(()=>{var e,r;return(null==(e=H.value)?void 0:e.enabled)&&(null==(r=H.value)?void 0:r.require_password)});l(async()=>{try{const e=await w.getConfig();G.value=e}catch(e){}});const N=t({username:"",email:"",code:"",password:""}),P=t({username:"",email:"",code:"",password:""}),Q=()=>{var e,r;P.username="",N.username?(null==(e=G.value.frontend)?void 0:e.username_regex)&&!new RegExp(G.value.frontend.username_regex).test(N.username)?P.username=x("register.validation.username_format",{regex:G.value.frontend.username_regex}):(null==(r=G.value.frontend)?void 0:r.username_regex)||/^[a-zA-Z0-9_]+$/.test(N.username)||(P.username=x("register.validation.username_format",{regex:"^[a-zA-Z0-9_]+$"})):P.username=x("register.validation.username_required")},T=()=>{P.email="",N.email?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(N.email)||(P.email=x("register.validation.email_format")):P.email=x("register.validation.email_required")},W=()=>{var e;P.password="",J.value&&(N.password?(null==(e=H.value)?void 0:e.password_regex)&&!new RegExp(H.value.password_regex).test(N.password)&&(P.password=x("register.validation.password_format",{regex:H.value.password_regex})):P.password=x("register.validation.password_required"))},X=()=>{P.code="",N.code||(P.code=x("register.validation.code_required"))},Y=s(()=>{const e=N.username&&N.email&&N.code&&!P.username&&!P.email&&!P.code;return J.value?e&&N.password&&!P.password:e}),ee=a(0),re=a(null),ae=e=>{ee.value=e,re.value&&clearInterval(re.value),re.value=setInterval(()=>{ee.value--,ee.value<=0&&(clearInterval(re.value),re.value=null)},1e3)},se=async()=>{if(!(O.value||ee.value>0||(T(),P.email))){O.value=!0,D.value="";try{const e=N.email.trim().toLowerCase(),r=await w.sendCode({email:e,language:x("lang")});if(r.success)M(x("register.codeSent")),ae(60);else if(r.remaining_seconds&&r.remaining_seconds>0){ae(r.remaining_seconds);const e=x("common.seconds","seconds"),a=x("common.second","second"),s=x("common.second"),l=!r.msg||r.msg.includes(s)||r.msg.includes(e)||r.msg.includes(a)?x("register.sendFailed"):r.msg;l&&Z(l)}else{const e=r.msg&&r.msg!==x("register.sendFailed")?r.msg:x("register.sendFailed");Z(e)}}catch(e){Z(x("register.sendFailed"))}finally{O.value=!1}}},le=async()=>{if(!K.value&&(Q(),T(),W(),X(),Y.value)){K.value=!0,D.value="";try{const e={username:N.username,email:N.email.trim().toLowerCase(),code:N.code,password:N.password,uuid:"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const r=16*Math.random()|0,a="x"==e?r:3&r|8;return a.toString(16)}),language:x("lang")},r=await w.register(e);r.success?(M(x("register.success")),Object.assign(N,{username:"",email:"",code:"",password:""})):Z(r.msg||x("register.failed"))}catch(e){e(x("register.failed"))}finally{K.value=!1}}};return(e,r)=>(g(),o("div",{class:n(["bg-white/10 backdrop-blur-xl border border-white/20 rounded-lg p-6 shadow-2xl relative overflow-hidden",J.value?"w-full max-w-md":"w-full max-w-sm"])},[r[4]||(r[4]=i("div",{class:"absolute inset-0 bg-gradient-to-br from-white/5 to-transparent pointer-events-none"},null,-1)),i("h2",v,d(e.$t("register.title")),1),i("p",f,d(e.$t("register.subtitle")),1),i("form",{onSubmit:p(le,["prevent"]),class:"space-y-4 relative z-10"},[i("div",h,[i("div",null,[i("label",y,d(e.$t("register.form.username")),1),m(i("input",{id:"username","onUpdate:modelValue":r[0]||(r[0]=e=>N.username=e),type:"text",placeholder:e.$t("register.form.username_placeholder"),class:n(["w-full px-4 py-2.5 bg-white/15 backdrop-blur-xl border border-white/25 rounded-lg text-white placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent transition-all duration-300 shadow-inner",{"border-red-400 focus:ring-red-400":P.username}]),onBlur:Q},null,42,_),[[c,N.username]]),P.username?(g(),o("p",k,d(P.username),1)):u("",!0)]),i("div",null,[i("label",$,d(e.$t("register.form.email")),1),m(i("input",{id:"email","onUpdate:modelValue":r[1]||(r[1]=e=>N.email=e),type:"email",placeholder:e.$t("register.form.email_placeholder"),class:n(["w-full px-4 py-2.5 bg-white/15 backdrop-blur-xl border border-white/25 rounded-lg text-white placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent transition-all duration-300 shadow-inner",{"border-red-400 focus:ring-red-400":P.email}]),onBlur:T},null,42,j),[[c,N.email]]),P.email?(g(),o("p",q,d(P.email),1)):u("",!0)]),J.value?(g(),o("div",C,[i("label",z,d(e.$t("register.form.password")),1),m(i("input",{id:"password","onUpdate:modelValue":r[2]||(r[2]=e=>N.password=e),type:"password",placeholder:e.$t("register.form.password_placeholder"),class:n(["w-full px-4 py-2.5 bg-white/15 backdrop-blur-xl border border-white/25 rounded-lg text-white placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent transition-all duration-300 shadow-inner",{"border-red-400 focus:ring-red-400":P.password}]),onBlur:W},null,42,F),[[c,N.password]]),P.password?(g(),o("p",B,d(P.password),1)):u("",!0),H.value.password_regex?(g(),o("p",R,d(e.$t("register.form.password_hint",{regex:H.value.password_regex})),1)):u("",!0)])):u("",!0),i("div",null,[i("label",U,d(e.$t("register.form.code")),1),i("div",V,[m(i("input",{id:"code","onUpdate:modelValue":r[3]||(r[3]=e=>N.code=e),type:"text",placeholder:e.$t("register.form.code_placeholder"),class:n(["w-full px-4 py-2.5 bg-white/15 backdrop-blur-xl border border-white/25 rounded-lg text-white placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent transition-all duration-300 shadow-inner",{"border-red-400 focus:ring-red-400":P.code}]),onBlur:X},null,42,I),[[c,N.code]]),i("button",{type:"button",onClick:se,disabled:O.value||!N.email||ee.value>0,class:"px-4 py-2.5 bg-white/15 backdrop-blur-xl border border-white/25 text-white rounded-lg hover:bg-white/25 hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed whitespace-nowrap transition-all duration-300 shadow-inner"},d(O.value?e.$t("register.sending"):ee.value>0?`${ee.value}s`:e.$t("register.sendCode")),9,L)]),P.code?(g(),o("p",S,d(P.code),1)):u("",!0)])]),i("button",{type:"submit",disabled:K.value||!Y.value,class:"w-full bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5"},[K.value?(g(),o("div",E)):u("",!0),i("span",null,d(e.$t("register.form.submit")),1)],8,A)],32)],2))}}),Z={class:"flex min-h-screen w-full items-center justify-center p-4 md:p-6 lg:p-10 bg-[#030303]"},K=e({__name:"Register",setup:e=>(e,r)=>(g(),o("div",Z,[x(M)]))});export{K as default};
